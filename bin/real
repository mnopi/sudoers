#!/bin/sh

# Absolute logical (symlink) or resolved (physical) path (if does not exists, accepts one level up to cd).
#
. strict.lib 2>/dev/null || { set -eu; PATH="$("$(dirname "${0}")/colon")" && export PATH && . strict.lib; }

#######################################
# Absolute logical (symlink) or resolved (physical) path (if does not exists, accepts one level up to cd).
# Arguments:
#   -l, --logical       Do not resolve symlinks (pwd)
#   path                  Path (default: cwd).
# Output:
#   Path or help message to stdout.
# Returns:
#   1 if parent directory does not exists.
#######################################
main() {
  logical=false

  for arg do
    case "${arg}" in
      -h|--help) usage "${0}"; exit ;;
      --desc) desc "${0}"; exit ;;
      --version) sudoers --version; exit ;;
      -l|--logical) logical=true ;;
      *) relative="${arg}"
    esac
  done

  relative="${relative-.}"
  [ -d "${relative}" ] || basename="/$(basename "${relative}")"  # does not exists or is file
  cd "$(dirname "${relative}")" || exit 1

  if $logical; then
    echo "$(pwd)${basename}"
  else
    echo "$(pwd -P)${basename}"
  fi
  unset arg basename logical relative
}

main "${@:-}"
