#!/bin/sh

#######################################
# Prepend (beginning), append (end) or remove to colon variables (PATH, INFOPATH, MANPATH etc.)
# Arguments:
#   directory         Directory to prepend (default), append (--append) or remove (--remove) (default: prepend)
#   path              Path value to manipulate (default: "").
# Optional Arguments:
#   --append          Add at the end.
#   --remove          Remove for the path value.
# Outputs:
#   Updated path.
# Examples:
#   $ colon /foo
#   foo
#   $ colon /foo /bar
#   /foo:/bar
#   $ colon /foo /bar --append
#   /bar:/foo
#   $ colon --append /foo /bar
#   /bar:/foo
#   $ colon /foo /bar:/foo
#   /bar
#   $ colon /foo --remove /bar:/foo
#   /bar
#######################################

append=false
remove=false

for arg do
  shift
  case "${arg}" in
    --append) append=true ;;
    --remove) remove=true ;;
    *) set -- "$@" "${arg}" ;;
  esac
done

echo "${1}" | grep -qE '^/|^.' || die "$(basename "${0}")": directory must be absolute / or .

case ":${2}:" in
  *:"${1}":*)
    ! $remove || echo "${2}" | sed "s|${1}:||; s|:${1}||; s|${1}||"
    ;;
  *)
    if $append; then
      echo "${2:+${2}:}${1}"
    else
      echo "${1}${2:+:${2}}"
    fi
  ;;
esac
